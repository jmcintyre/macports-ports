--- mythtv/external/FFmpeg/libavcodec/libx264.c.orig	2018-02-01 05:20:06.000000000 -0700
+++ mythtv/external/FFmpeg/libavcodec/libx264.c	2019-11-25 16:24:38.000000000 -0700
@@ -156,10 +156,16 @@
     x264_nal_t *nal;
     int nnal, i, ret;
     x264_picture_t pic_out;
+    int bit_depth;
 
     x264_picture_init( &x4->pic );
     x4->pic.img.i_csp   = x4->params.i_csp;
-    if (x264_bit_depth > 8)
+#if X264_BUILD >= 153
+    bit_depth = x4->params.i_bitdepth;
+#else
+    bit_depth = x264_bit_depth;
+#endif
+    if (bit_depth > 8)
         x4->pic.img.i_csp |= X264_CSP_HIGH_DEPTH;
     x4->pic.img.i_plane = avfmt2_num_planes(ctx->pix_fmt);
 
@@ -599,6 +605,22 @@
     AV_PIX_FMT_YUV444P10,
     AV_PIX_FMT_NONE
 };
+static const enum AVPixelFormat pix_fmts_all[] = {
+    AV_PIX_FMT_YUV420P,
+    AV_PIX_FMT_YUVJ420P,
+    AV_PIX_FMT_YUV422P,
+    AV_PIX_FMT_YUVJ422P,
+    AV_PIX_FMT_YUV444P,
+    AV_PIX_FMT_YUVJ444P,
+    AV_PIX_FMT_NV12,
+    AV_PIX_FMT_YUV420P10,
+    AV_PIX_FMT_YUV422P10,
+    AV_PIX_FMT_YUV444P10,
+#ifdef X264_CSP_I400
+    AV_PIX_FMT_GRAY8,
+#endif
+    AV_PIX_FMT_NONE
+};
 static const enum AVPixelFormat pix_fmts_8bit_rgb[] = {
 #ifdef X264_CSP_BGR
     AV_PIX_FMT_BGR24,
@@ -609,12 +631,16 @@
 
 static av_cold void X264_init_static(AVCodec *codec)
 {
+#if X264_BUILD < 153
     if (x264_bit_depth == 8)
         codec->pix_fmts = pix_fmts_8bit;
     else if (x264_bit_depth == 9)
         codec->pix_fmts = pix_fmts_9bit;
     else if (x264_bit_depth == 10)
         codec->pix_fmts = pix_fmts_10bit;
+#else
+    codec->pix_fmts = pix_fmts_all;
+#endif
 }
 
 #define OFFSET(x) offsetof(X264Context, x)
